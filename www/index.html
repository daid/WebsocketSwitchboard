<html>
<head>
<script>
var req = new XMLHttpRequest();
req.open("POST", "/game/register", false)
req.setRequestHeader("Content-Type", "application/json")
req.send(JSON.stringify({
    "name": "TEST",
    "game_id": 1,
    "game_version": 1,
    "secret_hash": "",
    "public": true,
    "address": ["123", "456"],
    "port": 32032
}))
console.log(req.response)

if (0) {

var ws = new WebSocket("ws://127.0.0.1:8080/game/master");
var server_id;
var server_secret;
ws.onopen = function(event)
{
    console.log(event)
}
ws.onmessage = function(event)
{
    console.log("SERVER", event, event.data)
    if (event.data == "AUTH")
    {
        ws.send("AUTH:VERY_SECRET_KEY")
    }
    else if (event.data.startsWith("ID:"))
    {
        var params = event.data.split(":")
        server_id = params[1]
        server_secret = params[2]
        ws_client = new WebSocket("ws://127.0.0.1:8080/game/" + server_id)
        ws_client.onopen = function(event)
        {
            console.log("client", event)
        }
        ws_client.onmessage = function(event)
        {
            console.log("client", event)
            ws_client.send(event.data)
        }
        ws_client.onclose = function(event)
        {
            console.log("client", event)
        }
    }
    else if (event.data == "CLIENT_CONNECTED")
    {
        ws.send("HELLOW!")
        
        ws_server2 = new WebSocket("ws://127.0.0.1:8080/game/master");
        ws_server2.onmessage = function(event)
        {
            console.log("SERVER2", event, event.data)
            if (event.data == "AUTH")
            {
                ws_server2.send("AUTH:VERY_SECRET_KEY:" + server_secret)
                
                ws_client2 = new WebSocket("ws://127.0.0.1:8080/game/" + server_id)
                ws_client2.onopen = function(event)
                {
                    console.log("client2", event)
                }
                ws_client2.onmessage = function(event)
                {
                    console.log("client2", event)
                    ws_client2.send(event.data)
                }
                ws_client2.onclose = function(event)
                {
                    console.log("client2", event)
                }
            }
        }
        ws_server2.onclose = function(event)
        {
            console.log("SERVER2", event)
        }
    }
}
ws.onclose = function(event)
{
    console.log("SERVER", event)
}
ws.onerror = function(event)
{
    console.log("SERVER", event)
}

}
</script>
</head>
<body>
Hi!
</body>
</html>